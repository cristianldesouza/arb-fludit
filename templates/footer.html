<footer class="footerWrap">
    <div class="footCont">
        <div class="footTop">
            <a class="footLogo" href="/">
                <img class="footLogoImg" src="/public/img/logo.svg" alt="Mejor">
            </a>
            <div class="tabbar">
                {{footer_left_menu}}
            </div>
        </div>
        <div class="footerText">
            <p>
                {{footer_right_menu}}
            </p>
        </div>
    </div>
</footer>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
<script>
    const url = new URL(window.location.href);
    const links = document.getElementsByTagName('a');
    const medium = url.searchParams.get('utm_medium');
    const campaign = url.searchParams.get('utm_campaign');
    const source = url.searchParams.get('utm_source');
    const term = url.searchParams.get('utm_term');

    function getAdText() {
        const lang = navigator.language || navigator.userLanguage;
        const langMap = {
            'pt': 'Publicidade',
            'es': 'Publicidad',
            'en': 'Advertisement',
            'fr': 'Publicité',
            'de': 'Werbung'
        };
        const baseLang = (lang.split('-')[0] || 'en').toLowerCase();
        return langMap[baseLang] || langMap['en'];
    }

    function addAdLabel(container, adText) {
        if (!container.querySelector('.ad-label')) {
            container.insertAdjacentHTML('afterbegin',
                `<div class="ad-label" style="font-size:13px;color:#888;text-align:center;margin-bottom:5px;">${adText}</div>`
            );
        }
    }

    function removeAdLabel(container) {
        const label = container.querySelector('.ad-label');
        if (label) {
            label.remove();
        }
    }

    function updateAllAds() {
        const adText = getAdText();
        const units = document.querySelectorAll('.adunit');
        units.forEach(unit => {
            const unitHeight = unit.offsetHeight;
            if (unitHeight > 40) {
                // Ad displayed
                addAdLabel(unit, adText);
                // unit.style.margin = 'auto';
                // unit.style.marginTop = '20px';
                // unit.style.marginBottom = '20px';
            } else {
                // Ad not displayed
                removeAdLabel(unit);
                unit.style.margin = '';
                unit.style.marginTop = '';
                unit.style.marginBottom = '';
            }
        });
    }

    function initAdLabelObserver() {
		window.googletag = window.googletag || {};
		window.googletag.cmd = window.googletag.cmd || [];

		window.googletag.cmd.push(function () {
			if (window.googletag && window.googletag.pubads) {
				window.googletag.pubads().addEventListener('slotRenderEnded', function (event) {
					try {
						updateAllAds();
					} catch (error) {
						console.error('Error updating ads:', error);
					}
				});
			}
		});

		document.addEventListener('DOMContentLoaded', updateAllAds);
	}

    document.addEventListener('DOMContentLoaded', function () {
        let attrs = {};

        if (source) attrs.source = source;

        if (campaign) attrs.campaign = campaign;

        if (medium) attrs.medium = medium;

        if (term) attrs.country = term;

        for (let link of links) {
            for (let attr in attrs) {
                if (!link.href.includes('?')) {
                    link.href = link.href + '?';
                } else {
                    link.href = link.href + '&';
                }

                if (attr == 'country') {
                    link.href += `utm_term=${attrs[attr]}`;
                } else {
                    link.href += `utm_${attr}=${attrs[attr]}`;
                }
            }
        }

        initAdLabelObserver();  
    });

    (function () {
        if (typeof notFoundPage !== "undefined") {
            console.log('Not found page is defined, ignoring preloader.')
            return false
        }

        if (
            !location.pathname.includes('/p/') &&
            !location.pathname.includes('/l/') &&
            !location.pathname.includes('/m/')
        ) {
            console.log('preloader isnt needed on this page.')
            return false
        }

        // Cria o overlay do preloader
        const preloader = document.createElement('div');
        preloader.id = 'custom-preloader';
        Object.assign(preloader.style, {
            position: 'fixed',
            top: '0',
            left: '0',
            width: '100%',
            height: '100%',
            backgroundColor: 'rgb(255 255 255 / 96%)', // Cor de fundo atualizada
            zIndex: '9999',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            flexShrink: '0',
        });

        // Cria a barra de carregamento no topo
        const progressBarContainer = document.createElement('div');
        Object.assign(progressBarContainer.style, {
            position: 'fixed',
            top: '0',
            left: '0',
            width: '100%',
            height: '4px',
            backgroundColor: '#e0e0e0', // Fundo da barra de carregamento
            overflow: 'hidden',
        });

        const progressBar = document.createElement('div');
        Object.assign(progressBar.style, {
            width: '0%',
            height: '100%',
            backgroundColor: 'var(--Theme)', // Cor da barra de carregamento
            transition: 'width 5s linear',
        });

        progressBarContainer.appendChild(progressBar);
        preloader.appendChild(progressBarContainer);

        // Cria o spinner central
        const spinner = document.createElement('div');
        Object.assign(spinner.style, {
            border: '8px solid #f3f3f3',
            borderTop: `8px solid var(--Theme)`, // Cor do spinner
            borderRadius: '50%',
            width: '60px',
            height: '60px',
            animation: 'spin 2s linear infinite',
            marginBottom: '20px',
        });

        // Adiciona o texto "Carregando"
        const loadingText = document.createElement('div');
        loadingText.innerText = '{{preloader_text}}';
        Object.assign(loadingText.style, {
            fontSize: '20px', // Aumenta o tamanho da fonte
            color: 'var(--TextPrimary);', // Cor do texto para melhor contraste
            fontWeight: 'bold', // Aumenta o peso da fonte
            marginBottom: '30px', // Espaçamento abaixo do texto
        });

        // Adiciona spinner e texto ao preloader
        preloader.appendChild(spinner);
        preloader.appendChild(loadingText);

        // Cria o badge "Site Seguro" com SVG de escudo
        const badge = document.createElement('div');
        Object.assign(badge.style, {
            position: 'fixed',
            bottom: '20px',
            display: 'flex',
            alignItems: 'center',
            backgroundColor: 'var(--Theme)',
            color: '#ffffff',
            padding: '12px 16px', // Aumenta o padding para dar mais espaço
            borderRadius: '25px', // Aumenta o raio para bordas mais arredondadas
            boxShadow: '0 4px 8px rgba(0,0,0,0.3)', // Sombra mais pronunciada
            fontSize: '16px', // Aumenta o tamanho da fonte
            fontWeight: 'bold', // Aumenta o peso da fonte
        });

        // SVG de escudo fornecido, aumentado de tamanho
        const shieldSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 512 512" style="margin-right: 8px;">
            <path d="M256 0c4.6 0 9.2 1 13.4 2.9L457.7 82.8c22 9.3 38.4 31 38.3 57.2c-.5 99.2-41.3 280.7-213.6 363.2c-16.7 8-36.1 8-52.8 0C57.3 420.7 16.5 239.2 16 140c-.1-26.2 16.3-47.9 38.3-57.2L242.7 2.9C246.8 1 251.4 0 256 0zm0 66.8l0 378.1C394 378 431.1 230.1 432 141.4L256 66.8s0 0 0 0z"/>
            </svg>
        `;

        // Adiciona o SVG e o texto ao badge
        badge.innerHTML = shieldSVG + ' {{secure_text}}';
        preloader.appendChild(badge);

        // Adiciona keyframes para a animação do spinner
        const styleSheet = document.createElement('style');
        styleSheet.type = 'text/css';
        styleSheet.innerText = `
            @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(styleSheet);

        // Adiciona o preloader ao body
        document.body.appendChild(preloader);

        // Armazena referências globais para manipulação futura
        window.loadingEl = preloader;
        window.loadingTimeout = setTimeout(() => {
            removePreloader();
        }, 5000);

        // Inicia a animação da barra de progresso
        setTimeout(() => {
            progressBar.style.width = '100%';
        }, 100); // Pequeno delay para garantir que a transição aconteça


        // Função para remover o preloader
        function removePreloader() {
            if (window.loadingEl) {
                window.loadingEl.style.transition = 'opacity 0.5s ease';
                window.loadingEl.style.opacity = '0';
                setTimeout(() => {
                    if (window.loadingEl && window.loadingEl.parentNode) {
                        window.loadingEl.parentNode.removeChild(window.loadingEl);
                        window.loadingEl = undefined;
                    }
                }, 500);
            }
            if (window.loadingTimeout) {
                clearTimeout(window.loadingTimeout);
                window.loadingTimeout = undefined;
            }
        }

        // Integração com Google Publisher Tags para remover o preloader quando o anúncio for carregado
        window.googletag = window.googletag || {};
        window.googletag.cmd = window.googletag.cmd || [];
        window.googletag.cmd.push(function () {
            if (window.googletag && window.googletag.pubads) {
                window.googletag.pubads().addEventListener('slotRenderEnded', function (event) {
                    try {
                        console.debug('slotRenderEnded', event.slot.getAdUnitPath(), event);
                        if (event.isEmpty) {
                            // Não vendeu, remove o preloader
                            removePreloader();
                        }
                        if (event.slot.getAdUnitPath().includes('header') || event.slot.getAdUnitPath().includes('top')) {
                            if (typeof window.loadingEl !== 'undefined') {
                                removePreloader();
                            }
                        }
                    } catch (error) {
                        console.error(error);
                    }
                });
            }
        });
    })();
</script>
<script src="/public/js/main.js"></script>
<script defer data-domain="fludit.com" src="https://start.fludit.com/js/script.hash.outbound-links.pageview-props.tagged-events.js"></script>
<script>
    window.plausible = window.plausible || function () {
        (window.plausible.q = window.plausible.q || []).push(arguments);
    }
</script>
<!-- custom scripts -->
</body>
</html>
